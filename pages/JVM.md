alias:: Java虚拟机

- 内存模型
	- ![JVM内存模型](../assets/image_1701787772981_0.png){:height 318, :width 445}
	- 运行时数据区
		- 程序计数器
			- 保存的是当前线程执行的进度
			- 执行引擎通过程序计数器进行线程切换和恢复
		- 本地方法栈
		- 栈/虚拟机栈
			- 栈帧
				- 每个方法被调用的时候，会创建一个栈帧，并入栈。一旦完成相应的调用，则出栈。所有栈帧出栈后，线程也随之结束
				- 每个栈帧包含
					- 局部变量表
					- 操作数栈
					- 动态连接
					- 返回地址/方法出口
		- 堆
			- 垃圾回收、操作的对象都是堆中的e数据
			- 堆中的数据是共享的，是占用内存最大的一块区域
		- 方法区/元空间
			- 常量池
			- 静态常量
			- 类信息
			- 运行时常量池
			- 方法数据
			- 方法代码
	- 字节码执行引擎
	- 类装载子系统 ((65709345-70bf-4b72-975a-ce2ed65ddd5e))
- 类加载
  id:: 65709345-70bf-4b72-975a-ce2ed65ddd5e
	- ![类加载流程](../assets/image_1701877523243_0.png)
	- 双亲委派
	- 类加载过程
		- 加载
			- 加载外部`.class`文件，加载到Java方法区内
		- 验证
			- 确保文件的字节流包含的信息符合当前虚拟机的要求，保证不会危害虚拟机的安全。
			- 验证方式有
				- 文件格式验证
					- 主要是保证Class文件符合Java信息的要求，如：文件类型、版本号、常量池、常量池数据等
					- 这一步字节流会进入内存的方法区中，后面的操作都是基于方法区内的存储结构进行的
				- 元数据验证
					- 对字节码描述信息进行语义分析，如：是否有父类、重载是否正确
					- 主要目的是对类的元数据进行语义分析，保证符合Java语言规范
				- 字节码验证
					- 对数据流和控制流进行分析。如：字节码指令集的正确，程序跳转的安全
					- 主要目的是检查方法体内的数据安全，确保程序语义合法，符合逻辑
				- 符号引用验证
					- 是一个比较特殊的阶段，主要为解析阶段服务，在解析过程中，虚拟机将符号引用转换为直接引用，主要是对常量池中的各种符号引用做匹配行校验
					- 主要校验
						- 符号引用指向的类能否找到
						- 指定的类有没有描述的方法和字段
						- 符号引用指向的各种信息的访问权限是不是对的
		- 准备
			- 为类变量（被static修饰的变量）分配内存并设置类变量的初始值，这里的初始值是指赋默认值，如数字默认0，boolean默认false。
			- 但特殊情况下，如：类变量是一个常量则直接设置为对应的常量值
		- 解析
			- 虚拟机将常量池的符号引用直接替换为直接引用的过程
				- 符号引用：能够无歧义定位目标的任何形式的字面量，和虚拟机实现的内存布局无关，引用的目标不一定要加载到内存中
				- 直接引用：可以直接目标指针，偏移量的引用，和虚拟机实现的内存布局相关，引用的目标一定要在内存中
			- 类和接口的解析
			- 字段解析
			- 类方法解析
				- 接口方法解析
		- 初始化
- 垃圾收集器
	- Serial收集器
	- ParNew收集器
	- Parallel Scavenge收集器
	- Serial Old收集器
	- CMS收集器
	- Garbage First收集器
	- Shenandoah收集器
	- ZGC收集器
	- Epsilon收集器